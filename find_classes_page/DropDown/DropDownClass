fetch("../classes.json").then(response => response.json()).then( function(jsonData){
    classesList = jsonData["data"]
  })




var subjectArr = []
var subjectDescriptionArr = []
var courseNumber = []
var courseTitle = []

var keyArray = [subjectArr,subjectDescriptionArr,courseNumber,courseTitle]
//called in dropDown class setListener()
function setKeys()
{
    if (subjectArr.length == 0)
    {
        for (var i = 0; i < classesList.length; ++i)
        {
            if (!subjectArr.includes(classesList[i].subject))
                subjectArr.push(classesList[i].subject)
                
            if (!subjectDescriptionArr.includes(classesList[i].subjectDescription))
                subjectDescriptionArr.push(classesList[i].subjectDescription)

            if (!courseNumber.includes(classesList[i].courseNumber))
                courseNumber.push(classesList[i].courseNumber)

            if (!courseTitle.includes(classesList[i].courseTitle))
                courseTitle.push(classesList[i].courseTitle)
        }

        for (var i = 0; i < keyArray.length; ++i)
            keyArray[i].sort()
    }
    
}



class dropDown {
    constructor(input,array,allArrays,elementName,divName)
    {
        this.input = input
        this.array = array
        this.allArrays = allArrays
        this.elementName = elementName
        this.divName = divName
        //this.addDropdownDiv()
        this.setListener()
    }

    addDropdownDiv()
    {
        console.log("here")
        const dropdownUI = document.getElementById(this.input)
        const element = document.createElement("div")
        element.id = this.divName
        //css class that the dropdown follows
        element.classList.add("dropdown-content")
        dropdownUI.insertAdjacentElement("beforeend",element)
        
    }

    setListener() 
    {
        self = this
        const inputElement = document.getElementById(this.input)
        inputElement.addEventListener('keyup', function()
        {
            setKeys()
            var userInput = document.getElementById(self.input).value
            userInput = String(userInput).toUpperCase()
            self.updateDropDown(userInput)
        })
    }

    updateDropDown(userInput)
    {
      

        this.clearChildren()

        for(var i = 0; i < this.array.length; ++i)
        {
            for(var j = 0; j < this.allArrays.length; ++j)
            {
                var arrayText = String(this.allArrays[j][i])
                if (arrayText.includes(userInput))
                {
                    this.addDropdown(this.array[i])
                    break
                    break
                }
                    
            }
          
        }
        
        
    }

    addDropdown(data)
    {
        // console.log(data)
        const dropdownUI = document.getElementById(this.divName)
        const aElement = document.createElement("div")
        aElement.id = this.elementName
        aElement.data = data
        const text = document.createTextNode(data)
        aElement.appendChild(text)
        // aElement.addEventListener("click", function(){
        //     selection(aElement.data,aElement.text)


        // })
        dropdownUI.insertAdjacentElement("beforeend",aElement)
    }

    clearChildren()
    {
        var divElement = document.getElementById(this.divName)
        while(divElement.firstChild){
            divElement.removeChild(divElement.firstChild)
        }
    }

}

document.addEventListener("DOMContentLoaded", function(){
    const drop = new dropDown("courseNumber-input",courseNumber,keyArray,"courseNumber","dropDownSubject2")
})

